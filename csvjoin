#!/usr/bin/env python
from csvkit import init_common_parser
import argparse

def main():
    parser = init_common_parser(description='Join a CSV file on a specified column or columns.',epilog="Note that the join operation requires reading all files into memory. Don't try this on very large files.",omitflags='f')

    parser.add_argument('files', metavar="FILES", nargs='+', type=argparse.FileType('r'),
                        help='The CSV files to operate on. If only one is specified, it will be copied to STDOUT.')

    parser.add_argument('-j', '--join', dest='join',
                        help='The columns on which to join. Should be either one, or a comma-separated list with one element for each file, in the same order the files were specified.')

    args = parser.parse_args()

    join_cols = map(str.strip,args.join.split(','))
    
    if len(join_cols) == 1:
        join_cols = join_cols * len(args.files)
        
    if len(join_cols) != len(args.files):
        raise ValueError("Number of join columns must match number of files, unless join column has the same name in all files.")
    
    for j,f in zip(join_cols,args.files):
        print j,f
    
if __name__ == '__main__':
    main()